graph TB
    subgraph "ğŸ“¡ Signal Propagation Module"
        subgraph "â° Time Management"
            TM["ğŸ• TimeManager<br/>â€¢ current_step<br/>â€¢ is_running<br/>â€¢ history[]<br/>â€¢ start/stop/pause"]
            TMC["âš™ï¸ TimeConfig<br/>â€¢ dt: 0.01<br/>â€¢ max_steps: 1000<br/>â€¢ mode: FIXED/ADAPTIVE"]
            TME["ğŸ“Š TimeMode<br/>â€¢ FIXED<br/>â€¢ ADAPTIVE"]
        end
        
        subgraph "ğŸŒŠ Signal Propagation Core"
            SP["ğŸ¯ SignalPropagator<br/>â€¢ propagate_step()<br/>â€¢ run_simulation()<br/>â€¢ get_output_signals()"]
            SPC["âš™ï¸ PropagationConfig<br/>â€¢ mode: WAVE<br/>â€¢ signal_strength: 1.0<br/>â€¢ wave_speed: 1.0"]
            SPM["ğŸ“Š PropagationMode<br/>â€¢ WAVE<br/>â€¢ DIFFUSION<br/>â€¢ DIRECTIONAL"]
        end
        
        subgraph "ğŸ” Pattern Analysis"
            PA["ğŸ” PatternAnalyzer<br/>â€¢ analyze_patterns()<br/>â€¢ spatial_analysis()<br/>â€¢ temporal_analysis()"]
            PAC["âš™ï¸ PatternConfig<br/>â€¢ confidence_threshold<br/>â€¢ window_sizes"]
            PT["ğŸ“Š PatternType<br/>â€¢ WAVE<br/>â€¢ SPIRAL<br/>â€¢ CLUSTERED<br/>â€¢ CHAOTIC<br/>â€¢ STATIC"]
        end
        
        subgraph "ğŸ¯ Convergence Detection"
            CD["ğŸ¯ ConvergenceDetector<br/>â€¢ check_convergence()<br/>â€¢ update_history()<br/>â€¢ get_status()"]
            ACD["ğŸ¤– AdaptiveConvergenceDetector<br/>â€¢ adaptive_threshold<br/>â€¢ auto_adjust()"]
            CC["âš™ï¸ ConvergenceConfig<br/>â€¢ tolerance: 1e-6<br/>â€¢ patience: 10"]
            CM["ğŸ“Š ConvergenceMode<br/>â€¢ ABSOLUTE<br/>â€¢ RELATIVE<br/>â€¢ ENERGY<br/>â€¢ COMBINED"]
        end
    end
    
    subgraph "ğŸ§  External Dependencies"
        CP["ğŸ”¬ CellPrototype<br/>from core.cell_prototype"]
        L3D["ğŸ—ï¸ Lattice3D<br/>from core.lattice_3d"]
        TORCH["âš¡ PyTorch<br/>torch.Tensor operations"]
        NUMPY["ğŸ”¢ NumPy<br/>correlation analysis"]
    end
    
    subgraph "ğŸ“Š Data Flow"
        INPUT["ğŸ“¥ Input Signals<br/>[face_x, face_y, state_size]"]
        CURRENT["ğŸ”„ Current State<br/>[x, y, z, state_size]"]
        OUTPUT["ğŸ“¤ Output Signals<br/>[face_x, face_y, state_size]"]
        STATS["ğŸ“ˆ Statistics<br/>â€¢ patterns<br/>â€¢ convergence<br/>â€¢ performance"]
    end
    
    %% ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑĞ²ÑĞ·Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
    SP --> TM
    SP --> PA
    SP --> CD
    SP --> L3D
    SP --> CP
    
    %% ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞ²ÑĞ·Ğ¸
    TMC --> TM
    TME --> TMC
    SPC --> SP
    SPM --> SPC
    PAC --> PA
    PT --> PA
    CC --> CD
    CM --> CC
    ACD --> CD
    
    %% Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
    SP --> TORCH
    PA --> NUMPY
    L3D --> CP
    
    %% ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    INPUT --> SP
    SP --> CURRENT
    CURRENT --> SP
    SP --> OUTPUT
    SP --> STATS
    PA --> STATS
    CD --> STATS
    TM --> STATS
    
    %% Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ SignalPropagator
    SP -.->|"wave_propagation()"| TORCH
    SP -.->|"diffusion_propagation()"| TORCH
    SP -.->|"directional_propagation()"| TORCH
    SP -.->|"_apply_cellular_dynamics()"| CP
    
    %% ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿ÑƒÑ‚Ğ¸ (Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ñ‹ ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¼)
    SP -->|"CRITICAL"| TM
    SP -->|"CRITICAL"| L3D
    L3D -->|"CRITICAL"| CP
    
    %% DOM Events (Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸)
    SP -.->|"time_step_event"| TM
    PA -.->|"pattern_detected_event"| SP
    CD -.->|"convergence_event"| SP
    
    %% Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    classDef coreClass fill:#90EE90,stroke:#228B22,stroke-width:2px
    classDef configClass fill:#87CEEB,stroke:#4682B4,stroke-width:2px
    classDef enumClass fill:#DDA0DD,stroke:#9370DB,stroke-width:2px
    classDef externalClass fill:#F0E68C,stroke:#DAA520,stroke-width:2px
    classDef dataClass fill:#FFB6C1,stroke:#DC143C,stroke-width:2px
    classDef criticalPath stroke:#FF0000,stroke-width:4px
    
    class SP,TM,PA,CD,ACD coreClass
    class TMC,SPC,PAC,CC configClass
    class TME,SPM,PT,CM enumClass
    class CP,L3D,TORCH,NUMPY externalClass
    class INPUT,CURRENT,OUTPUT,STATS dataClass 