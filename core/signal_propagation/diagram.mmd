graph TB
    subgraph "📡 Signal Propagation Module"
        subgraph "⏰ Time Management"
            TM["🕐 TimeManager<br/>• current_step<br/>• is_running<br/>• history[]<br/>• start/stop/pause"]
            TMC["⚙️ TimeConfig<br/>• dt: 0.01<br/>• max_steps: 1000<br/>• mode: FIXED/ADAPTIVE"]
            TME["📊 TimeMode<br/>• FIXED<br/>• ADAPTIVE"]
        end
        
        subgraph "🌊 Signal Propagation Core"
            SP["🎯 SignalPropagator<br/>• propagate_step()<br/>• run_simulation()<br/>• get_output_signals()"]
            SPC["⚙️ PropagationConfig<br/>• mode: WAVE<br/>• signal_strength: 1.0<br/>• wave_speed: 1.0"]
            SPM["📊 PropagationMode<br/>• WAVE<br/>• DIFFUSION<br/>• DIRECTIONAL"]
        end
        
        subgraph "🔍 Pattern Analysis"
            PA["🔎 PatternAnalyzer<br/>• analyze_patterns()<br/>• spatial_analysis()<br/>• temporal_analysis()"]
            PAC["⚙️ PatternConfig<br/>• confidence_threshold<br/>• window_sizes"]
            PT["📊 PatternType<br/>• WAVE<br/>• SPIRAL<br/>• CLUSTERED<br/>• CHAOTIC<br/>• STATIC"]
        end
        
        subgraph "🎯 Convergence Detection"
            CD["🎯 ConvergenceDetector<br/>• check_convergence()<br/>• update_history()<br/>• get_status()"]
            ACD["🤖 AdaptiveConvergenceDetector<br/>• adaptive_threshold<br/>• auto_adjust()"]
            CC["⚙️ ConvergenceConfig<br/>• tolerance: 1e-6<br/>• patience: 10"]
            CM["📊 ConvergenceMode<br/>• ABSOLUTE<br/>• RELATIVE<br/>• ENERGY<br/>• COMBINED"]
        end
    end
    
    subgraph "🧠 External Dependencies"
        CP["🔬 CellPrototype<br/>from core.cell_prototype"]
        L3D["🏗️ Lattice3D<br/>from core.lattice_3d"]
        TORCH["⚡ PyTorch<br/>torch.Tensor operations"]
        NUMPY["🔢 NumPy<br/>correlation analysis"]
    end
    
    subgraph "📊 Data Flow"
        INPUT["📥 Input Signals<br/>[face_x, face_y, state_size]"]
        CURRENT["🔄 Current State<br/>[x, y, z, state_size]"]
        OUTPUT["📤 Output Signals<br/>[face_x, face_y, state_size]"]
        STATS["📈 Statistics<br/>• patterns<br/>• convergence<br/>• performance"]
    end
    
    %% Основные связи компонентов
    SP --> TM
    SP --> PA
    SP --> CD
    SP --> L3D
    SP --> CP
    
    %% Конфигурационные связи
    TMC --> TM
    TME --> TMC
    SPC --> SP
    SPM --> SPC
    PAC --> PA
    PT --> PA
    CC --> CD
    CM --> CC
    ACD --> CD
    
    %% Внешние зависимости
    SP --> TORCH
    PA --> NUMPY
    L3D --> CP
    
    %% Поток данных
    INPUT --> SP
    SP --> CURRENT
    CURRENT --> SP
    SP --> OUTPUT
    SP --> STATS
    PA --> STATS
    CD --> STATS
    TM --> STATS
    
    %% Специфические методы SignalPropagator
    SP -.->|"wave_propagation()"| TORCH
    SP -.->|"diffusion_propagation()"| TORCH
    SP -.->|"directional_propagation()"| TORCH
    SP -.->|"_apply_cellular_dynamics()"| CP
    
    %% Критические пути (выделены красным)
    SP -->|"CRITICAL"| TM
    SP -->|"CRITICAL"| L3D
    L3D -->|"CRITICAL"| CP
    
    %% DOM Events (для интеграции)
    SP -.->|"time_step_event"| TM
    PA -.->|"pattern_detected_event"| SP
    CD -.->|"convergence_event"| SP
    
    %% Стили для улучшения визуализации
    classDef coreClass fill:#90EE90,stroke:#228B22,stroke-width:2px
    classDef configClass fill:#87CEEB,stroke:#4682B4,stroke-width:2px
    classDef enumClass fill:#DDA0DD,stroke:#9370DB,stroke-width:2px
    classDef externalClass fill:#F0E68C,stroke:#DAA520,stroke-width:2px
    classDef dataClass fill:#FFB6C1,stroke:#DC143C,stroke-width:2px
    classDef criticalPath stroke:#FF0000,stroke-width:4px
    
    class SP,TM,PA,CD,ACD coreClass
    class TMC,SPC,PAC,CC configClass
    class TME,SPM,PT,CM enumClass
    class CP,L3D,TORCH,NUMPY externalClass
    class INPUT,CURRENT,OUTPUT,STATS dataClass 