# Signal Propagation Module

## Обзор

Модуль `signal_propagation` реализует временную динамику и распространение сигналов в 3D клеточной нейронной сети. Это ключевой компонент, который оживляет статическую решетку клеток, добавляя временное измерение и сложное поведение.

## Основная Идея

Представьте себе волну, распространяющуюся по поверхности воды, или электрический импульс, проходящий через нервную ткань. Этот модуль моделирует похожие процессы в 3D решетке "умных клеток", где сигналы могут:

- **Распространяться волнами** через пространство
- **Диффундировать** как газ или жидкость
- **Двигаться направленно** к определенной цели
- **Формировать сложные паттерны** (спирали, кластеры, хаос)
- **Достигать стабильного состояния** (сходимость)

## Архитектура

### Основные Компоненты

1. **TimeManager** - Управление временем и историей
2. **SignalPropagator** - Основная логика распространения
3. **PatternAnalyzer** - Анализ пространственно-временных паттернов
4. **ConvergenceDetector** - Детекция сходимости системы

### Взаимодействие Компонентов

```
SignalPropagator
├── TimeManager (временная динамика)
├── Lattice3D (пространственная структура)
├── PatternAnalyzer (анализ паттернов)
└── ConvergenceDetector (детекция сходимости)
```

## Режимы Распространения

### WAVE (Волновое)

- Сигналы распространяются волнами с заданной скоростью
- Подходит для моделирования нервных импульсов
- Синусоидальная модуляция амплитуды

### DIFFUSION (Диффузионное)

- Сглаживание сигналов между соседними клетками
- Моделирует диффузию веществ в ткани
- Постепенное выравнивание концентраций

### DIRECTIONAL (Направленное)

- Направленное движение сигналов в заданном векторе
- Моделирует направленные потоки
- Полезно для ориентированных задач

## Детекция Паттернов

Система автоматически распознает:

- **WAVE** - волновые фронты и периодические структуры
- **SPIRAL** - спиральные паттерны с центрами вращения
- **UNIFORM** - равномерное распределение активности
- **CLUSTERED** - локализованные области активности
- **CHAOTIC** - хаотическое, нерегулярное поведение
- **STATIC** - отсутствие значимых изменений

## Критерии Сходимости

Множественные критерии для определения стабилизации:

- **ABSOLUTE** - абсолютное изменение ниже порога
- **RELATIVE** - относительное изменение незначительно
- **ENERGY** - общая энергия системы стабилизировалась
- **GRADIENT** - градиенты изменений малы
- **STATISTICAL** - статистические моменты стабильны
- **COMBINED** - комбинация всех критериев

## Использование

### Базовое Использование

```python
from core.signal_propagation import SignalPropagator, TimeManager, PropagationConfig
from core.lattice_3d import Lattice3D

# Создание компонентов
lattice = Lattice3D(config)
time_manager = TimeManager(time_config)
propagator = SignalPropagator(lattice, time_manager, PropagationConfig())

# Инициализация сигналов
input_signals = torch.randn(3, 3, 8)  # Сигналы на входной грани
propagator.initialize_signals(input_signals, input_face="front")

# Выполнение шагов симуляции
for step in range(10):
    current_state = propagator.propagate_step()
    print(f"Шаг {step}: средняя активность = {current_state.mean()}")

# Получение результатов
output_signals = propagator.get_output_signals("back")
stats = propagator.get_stats()
```

### Полная Симуляция

```python
# Запуск полной симуляции с автоматической остановкой
history = propagator.run_simulation(max_steps=100)

print(f"Симуляция завершена за {len(history)} шагов")
print(f"Обнаруженные паттерны: {propagator.pattern_analyzer.get_detected_patterns()}")
```

## Конфигурация

Модуль полностью настраивается через YAML файлы:

```yaml
propagation:
  mode: "wave" # wave, diffusion, directional
  signal_strength: 1.0
  decay_rate: 0.1
  wave_speed: 1.0
  diffusion_coefficient: 0.5
  direction_vector: [1.0, 0.0, 0.0]

time:
  dt: 0.01
  max_time_steps: 1000
  mode: "fixed" # fixed, adaptive

convergence:
  mode: "combined"
  tolerance: 1e-6
  patience: 10
```

## Визуализация

Модуль предоставляет богатые возможности для анализа:

- История изменения сигналов во времени
- Статистика распространения (скорость, амплитуда)
- Обнаруженные паттерны с уровнем уверенности
- Критерии сходимости и время стабилизации

## Интеграция

Модуль плотно интегрирован с другими компонентами системы:

- **cell_prototype** - использует клеточную динамику для обновления состояний
- **lattice_3d** - работает с 3D решеткой и топологией соседства
- **main.py** - интегрируется в основной пайплайн приложения

## Особенности Реализации

- **Эффективность**: Векторизованные операции PyTorch
- **Гибкость**: Множественные режимы и конфигурации
- **Надежность**: Обработка ошибок и граничных случаев
- **Наблюдаемость**: Подробное логирование и статистика
- **Тестируемость**: Полное покрытие unit и интеграционными тестами

## Статус

✅ **Модуль полностью готов и протестирован**

- Все основные компоненты реализованы
- Интеграционные тесты пройдены
- Документация завершена
- Готов к использованию в Phase 2
