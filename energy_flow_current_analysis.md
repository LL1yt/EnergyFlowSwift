# üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ energy_flow

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-08
**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –î–∞

## üéØ –†–µ–∑—é–º–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **–ü–ï–†–ï–•–û–î–ù–û–ú –°–û–°–¢–û–Ø–ù–ò–ò** –º–µ–∂–¥—É —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

```
AssertionError: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ [-1,1], –ø–æ–ª—É—á–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω: [-0.939, 1.081]
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:

- –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `relative_coordinates=True`, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ `False`
- –°–º–µ—â–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º `displacement_scale=5.0` –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ clamp

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ –¥–æ–ª–≥–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ (2-5 —Å–µ–∫—É–Ω–¥)**

**–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** `energy_lattice.py`, –º–µ—Ç–æ–¥ `place_initial_energy()`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ 100,000+ –ø–æ—Ç–æ–∫–æ–≤ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```python
# –°—Ç—Ä–æ–∫–∏ 300-316: —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
for (x, y), energy, batch_idx in cell_energies:
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    flow_id = self._create_flow(normalized_position, energy, batch_idx=batch_idx)
    if len(flow_ids) <= 5:
        logger.debug_init(f"üÜ´ Created flow {flow_id}...")  # –ó–∞–º–µ–¥–ª—è–µ—Ç –¥–ª—è –ø–µ—Ä–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
```

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –ë–∞—Ç—á–µ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –±–µ–∑ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
def place_initial_energy_batched(self, embeddings, mapper):
    # 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –±–∞—Ç—á–µ–º
    positions = self._prepare_initial_positions_batch(batch_size)

    # 2. –°–æ–∑–¥–∞—Ç—å –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π
    flow_ids = self._create_flows_batch(positions, energies)

    # 3. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—É–º–º–∞—Ä–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    logger.info(f"Created {len(flow_ids)} flows in {time:.2f}s")
```

### 2. **–û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã—Ö–æ–¥—è—Ç –∑–∞ [-1, 1]**

**–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** `energy_carrier.py`, —Å—Ç—Ä–æ–∫–∏ 210-271

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π –ë–ï–ó —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ clamp:

```python
# –°—Ç—Ä–æ–∫–∞ 210-211: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
current_scale = self._calculate_displacement_scale(global_training_step)
displacement_normalized *= current_scale  # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 5.0!

# –°—Ç—Ä–æ–∫–∞ 232: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ –ø–æ–∑–∏—Ü–∏–∏
next_position = current_position + displacement_normalized

# –°—Ç—Ä–æ–∫–∞ 271: clamp –ü–û–°–õ–ï –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–æ –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
next_position = torch.clamp(next_position, -1.0, 1.0)
```

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≥—Ä–∞–Ω–∏—Ü
def apply_displacement_with_scaling(self, current_pos, displacement, scale):
    # 1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Å–º–µ—â–µ–Ω–∏–µ
    scaled_displacement = displacement * scale

    # 2. –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
    new_position = current_pos + scaled_displacement

    # 3. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô clamp –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ [-1, 1]
    new_position = torch.clamp(new_position, -1.0, 1.0)

    return new_position
```

### 3. **–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–ª–∞–≥–∏ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

```python
# energy_config.py
relative_coordinates=True      # –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
center_start_enabled=True      # –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
dual_output_planes=True        # –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

# –ù–û –≤ –∫–æ–¥–µ:
if self.config.relative_coordinates:  # –£—Å–ª–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å
    # –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
else:
    # —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –≤—Å–µ –µ—â–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## ‚úÖ –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

1. ‚úÖ **Mixed Precision Training** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
2. ‚úÖ **Gradient Accumulation** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ **Learning Rate Scheduling** - ReduceLROnPlateau –Ω–∞—Å—Ç—Ä–æ–µ–Ω
4. ‚úÖ **Text Bridge** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ **Convergence Detection** - –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ

---

## ‚ùå –ß—Ç–æ –ù–ï –∞–∫—Ç—É–∞–ª—å–Ω–æ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞

1. ‚ùå **torch.compile** - –æ—Ç–ª–æ–∂–µ–Ω–æ (–Ω–µ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)
2. ‚ùå **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç** - –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è GPU
3. ‚ùå **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π spawn threshold** - —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ movement_based_spawn

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (2025-01-08)

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
**–§–∞–π–ª:** `energy_flow/core/energy_carrier.py`
- –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π clamp —Å–º–µ—â–µ–Ω–∏–π –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 213)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π –¥–æ [-0.5, 0.5] –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≥—Ä–∞–Ω–∏—Ü
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π clamp –ø–æ—Å–ª–µ —Å–ª–æ–∂–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏ —Å–º–µ—â–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ 236)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω clamp –¥–ª—è exploration noise (—Å—Ç—Ä–æ–∫–∞ 270)

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤
**–§–∞–π–ª:** `energy_flow/core/energy_lattice.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_batch_create_flows()` –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
- –£–±—Ä–∞–Ω–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (–ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5)
- –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: —Å 2-5 —Å–µ–∫—É–Ω–¥ –¥–æ <0.5 —Å–µ–∫—É–Ω–¥

### 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏
**–§–∞–π–ª:** `energy_flow/core/flow_processor.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `cleanup_memory_safe()` (—Å—Ç—Ä–æ–∫–∞ 849)
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 10 —à–∞–≥–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- –û—á–∏—Å—Ç–∫–∞ GPU –∫—ç—à–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 20GB
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –ü–ª–∞–Ω –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —É–ª—É—á—à–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å–µ–≥–æ–¥–Ω—è)

#### 1.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

```python
# energy_carrier.py, —Å—Ç—Ä–æ–∫–∏ 206-271
# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π clamp –ü–ï–†–ï–î –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
displacement_normalized = torch.clamp(displacement_raw * current_scale, -1.0, 1.0)
next_position = torch.clamp(current_position + displacement_normalized, -1.0, 1.0)
```

#### 1.2 –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Ç–æ–∫–æ–≤

```python
# energy_lattice.py - –±–∞—Ç—á–µ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞
def place_initial_energy_batched(self, embeddings, mapper):
    # –í–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
    all_positions = self._prepare_positions_grid()
    all_energies = mapper.map_to_surface(embeddings)

    # –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫–∏ –±–∞—Ç—á–µ–º
    with torch.no_grad():
        flow_data = self._batch_create_flows(all_positions, all_energies)

    logger.info(f"Created {len(flow_data)} flows")
    return flow_data
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏

#### 2.1 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –ø–∞–º—è—Ç–∏

```python
# flow_processor.py
def cleanup_memory_safe(self):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    if self.step_counter % self.memory_cleanup_interval == 0:
        # 1. –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
        completed_ids = [fid for fid, flow in self.active_flows.items()
                        if not flow.is_active]

        for fid in completed_ids:
            del self.active_flows[fid]

        # 2. –û—á–∏—â–∞–µ–º GPU –∫—ç—à —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
        mem_allocated = torch.cuda.memory_allocated() / 1e9  # GB
        if mem_allocated > self.memory_threshold_gb:
            torch.cuda.empty_cache()
            logger.debug(f"Cleaned {len(completed_ids)} flows, freed GPU cache")
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 3.1 –£–¥–∞–ª–∏—Ç—å —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É —Å—Ç–∞—Ä–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```python
# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–ª–æ–∫–∏:
if self.config.relative_coordinates:
    # –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç—É —á–∞—Å—Ç—å
else:
    # –£–î–ê–õ–ò–¢–¨ —ç—Ç—É —á–∞—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
```

#### 3.2 –£–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

```python
# –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
# –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ fallback –ª–æ–≥–∏–∫—É
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤: 2-5 —Å–µ–∫—É–Ω–¥
- –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç
- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è: ~10 steps/sec

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤: < 0.5 —Å–µ–∫—É–Ω–¥
- –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π
- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è: ~50 steps/sec

---

## üéØ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
2. **–°–µ–≥–æ–¥–Ω—è:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Ç–æ–∫–æ–≤
3. **–°–µ–≥–æ–¥–Ω—è:** –î–æ–±–∞–≤–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –æ—á–∏—Å—Ç–∫—É –ø–∞–º—è—Ç–∏
4. **–ó–∞–≤—Ç—Ä–∞:** –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
5. **–ü–æ–∑–∂–µ:** –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –¢–µ—Å—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
python test_energy_flow.py --mode debug --steps 10

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
python benchmark_initialization.py

# –¢–µ—Å—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
python memory_test.py --duration 300
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º torch.compile** - –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –¥–æ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
2. **–ù–ï —Ç—Ä–æ–≥–∞–µ–º GRU –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é** - —Ç–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∂–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - GPU –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–∞—è

---

_–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ CLAUDE.md –∏ energy_flow_analysis.md —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞._
