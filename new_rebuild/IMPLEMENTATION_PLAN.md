# üéØ –ü–õ–ê–ù –ü–ï–†–ï–•–û–î–ê –ö CLEAN –ê–†–•–ò–¢–ï–ö–¢–£–†–ï

## 3D –ö–ª–µ—Ç–æ—á–Ω–∞—è –ù–µ–π—Ä–æ–Ω–Ω–∞—è –°–µ—Ç—å - Clean Implementation

> **–°–¢–ê–¢–£–°**: –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å–ª–æ–∂–Ω–æ–π legacy –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏ –º–æ–¥—É–ª—å–Ω–æ–π  
> **–¶–ï–õ–¨**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö  
> **–†–ï–ó–£–õ–¨–¢–ê–¢**: —É–¥–æ–±–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π. –Ω–∏–∫–∞–∫–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **MinimalNCACell** - –≥–æ—Ç–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (~69 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
2. **EmergentGMLPCell** - –≥–æ—Ç–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (~23000 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
3. **3D Lattice** - –∫–æ–Ω—Ü–µ–ø—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ—à–µ—Ç–∫–∏
4. **Hybrid –ø–æ–¥—Ö–æ–¥** - NCA –Ω–µ–π—Ä–æ–Ω—ã + gMLP —Å–≤—è–∑–∏
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - —É–¥–∞—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
6. –¥–µ—Ä–∂–∏–º –ø–ª–∞–Ω —É—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–º - –Ω–∞–ø—Ä–æ—Ç–∏–≤ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ —Å—Ö–µ–º–µ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –µ–≥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ - –∂–¥—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏–º–µ—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
7. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - —Å—Ç–∞—Ä–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ –±—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ª–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–≤–∏–≤–∞—Ç—å –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
   @PHASE_4_PLAN.md - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—É—Ç–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ –ø—Ä–æ–µ–∫—Ç, –Ω–æ –æ–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –Ω–µ—É–¥–∞—á–µ–π.

### ‚ùå –ß–¢–û –ò–°–ö–õ–Æ–ß–ê–ï–ú:

1. **CLI –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ Python API
2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω centralized_config.py
3. **Legacy —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —á–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üîç –ê–ù–ê–õ–ò–ó –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### ‚úÖ –ì–û–¢–û–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–Ω–∞–π–¥–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ):

#### **1. MinimalNCACell** (~69 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚úÖ

- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `core/cell_prototype/architectures/minimal_nca_cell.py`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: state_size=4, hidden_dim=3, neighbor_count=26
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–Ω–æ—Å—É
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: NCA –¥–∏–Ω–∞–º–∏–∫–∞, learnable weights –¥–ª—è —Å–æ—Å–µ–¥–µ–π

#### **2. gmlp** (~50000 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚úÖ

- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `core\cell_prototype\architectures\gmlp_opt_connections.py`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: state_size=32, hidden_dim=64, spatial_connections=True
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–Ω–æ—Å—É
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏, –ø–∞–º—è—Ç—å –æ—Ç–∫–ª—é—á–∞–µ–º–∞

#### **3. 3D Lattice —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** ‚úÖ

- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `core/lattice_3d/lattice.py`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: Topology, neighbor finding, boundary conditions
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**:

#### **4. Hybrid –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚ö†Ô∏è (—á–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤–∞)

- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `FINAL_HYBRID_ARCHITECTURE_IMPLEMENTATION_PLAN.md`
- **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –≥–æ—Ç–æ–≤–∞, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **–ó–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HybridNCAGMLPCell

---

## üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò new_rebuild

### **–≠–¢–ê–ü 1: –ë–ê–ó–û–í–ê–Ø –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê** ‚è±Ô∏è 1-2 —á–∞—Å–∞

#### 1.1 –°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```python
# new_rebuild/config/project_config.py
@dataclass
class ProjectConfig:
    """–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã"""

    # === –ê–†–•–ò–¢–ï–ö–¢–£–†–ê ===
    architecture_type: str = "hybrid"  # nca | gmlp | hybrid

    # === 3D –†–ï–®–ï–¢–ö–ê ===
    # –ù–∞—á–∏–Ω–∞–µ–º —Å –º–∞–ª–æ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –¥–æ —Ü–µ–ª–∏
    lattice_dimensions: Tuple[int, int, int] = (6, 6, 6)  # –æ—Ç–ª–∞–¥–∫–∞
    lattice_dimensions: Tuple[int, int, int] = (16, 16, 16)  # test
    target_dimensions: Tuple[int, int, int] = (666, 666, 333)  # –Ω–∞—É—á–Ω—ã–µ –æ–ø—ã—Ç—ã

    # === NCA –ù–ï–ô–†–û–ù–´ (–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–æ–≥) ===
    nca_state_size: int = 4      # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–π—Ä–æ–Ω–∞
    nca_hidden_dim: int = 3      # –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    nca_neighbor_count: int = 26 # 3D Moore neighborhood
    nca_target_params: int = 69  # ~60 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–∫ –≤ –±–∏–æ–ª–æ–≥–∏–∏
    nca_activation: str = "tanh" # —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –¥–ª—è NCA

    # === gMLP –°–í–Ø–ó–ò (–º–µ–∂–Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è) ===
    gmlp_state_size: int = 32       # —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å NCA
    gmlp_hidden_dim: int = 364      # –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤—è–∑–µ–π
    gmlp_target_params: int = 80000 # ~10k —Å–≤—è–∑–µ–π –∫–∞–∫ –≤ –±–∏–æ–ª–æ–≥–∏–∏, –Ω–æ —Ç–∞–∫ –∫–∞–∫ —Ä–∞–∑–º–µ—Ä —Å–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å, —Ç–æ –º–æ–∂–Ω–æ –∏ –±–æ–ª—å—à–µ –≤–∑—è—Ç—å 50k-100k
    gmlp_activation: str = "gelu"   # —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
    gmlp_use_memory: bool = False   # –ø–∞–º—è—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ (shared weights)

    # === HYBRID –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ===
    hybrid_nca_weight: float = 0.1  # 10% –≤–ª–∏—è–Ω–∏–µ –Ω–µ–π—Ä–æ–Ω–æ–≤
    hybrid_gmlp_weight: float = 0.9 # 90% –≤–ª–∏—è–Ω–∏–µ —Å–≤—è–∑–µ–π

    # === –û–ë–£–ß–ï–ù–ò–ï ===
    learning_rate: float = 0.001
    batch_size: int = 4
    device: str = "cuda"  # auto-detect cuda/cpu

    # === –≠–ú–ë–ï–î–î–ò–ù–ì–ò === data\embedding_adapter\universal_adapter.py
    embedding_dim: int = 768     # from DistilBERT
    phrase_based_training: bool = True  # —Ü–µ–ª—ã–µ —Ñ—Ä–∞–∑—ã, –Ω–µ —Ç–æ–∫–µ–Ω—ã
```

#### 1.2 –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–ª–µ—Ç–∫–∏

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `MinimalNCACell` ‚Üí `new_rebuild/core/cells/nca_cell.py`
2. ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `gmlp` ‚Üí `new_rebuild/core/cells/gmlp_connections.py`
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BaseCell`

#### 1.3 –°–æ–∑–¥–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—É—é 3D —Ä–µ—à–µ—Ç–∫—É

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `Lattice3D`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ 6-—Å–æ—Å–µ–¥—Å—Ç–≤–æ –∏–ª–∏ 26-—Å–æ—Å–µ–¥—Å—Ç–≤–æ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –≤ –∏–¥–µ–∞–ª–µ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å –æ 10000 —Å–æ—Å–µ–¥—è—Ö
3. ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: periodic
4. ‚úÖ –ú–µ—Ç–æ–¥—ã: `get_neighbors()`, `forward_pass()`, `get_states()`

### **–≠–¢–ê–ü 2: HYBRID –ê–†–•–ò–¢–ï–ö–¢–£–†–ê** ‚è±Ô∏è 2-3 —á–∞—Å–∞

#### 2.1 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HybridCell

```python
# new_rebuild/core/hybrid/hybrid_cell.py
class HybridCell(BaseCell):
    """
    –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è:
    - NCA –Ω–µ–π—Ä–æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É
    - gMLP —Å–≤—è–∑–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –º–µ–∂–Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    - Learnable –≤–µ—Å–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    """

    def __init__(self, config: ProjectConfig):
        super().__init__()

        # NCA –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–Ω–µ–π—Ä–æ–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞)
        self.nca_neuron = NCACell(
            state_size=config.nca_state_size,
            hidden_dim=config.nca_hidden_dim,
            neighbor_count=config.nca_neighbor_count,
            activation=config.nca_activation,
            target_params=config.nca_target_params
        )

        # gMLP –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–µ–π—Ä–æ–Ω–∞–º–∏)
        self.gmlp_connections = GMLPCell(
            state_size=config.gmlp_state_size,
            hidden_dim=config.gmlp_hidden_dim,
            use_memory=config.gmlp_use_memory,
            activation=config.gmlp_activation,
            target_params=config.gmlp_target_params
        )

        # Learnable –≤–µ—Å–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        self.integration_weights = nn.Parameter(
            torch.tensor([config.hybrid_nca_weight, config.hybrid_gmlp_weight])
        )

        # –ü—Ä–æ–µ–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π
        self.nca_projection = nn.Linear(config.nca_state_size, config.nca_state_size)
        self.gmlp_projection = nn.Linear(config.gmlp_state_size, config.nca_state_size)

    def forward(self, own_state, neighbor_states, external_input=None):
        """
        Hybrid forward: NCA –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, gMLP - —Å–≤—è–∑–∏
        """
        # NCA: –ª–æ–∫–∞–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –Ω–µ–π—Ä–æ–Ω–∞
        nca_output = self.nca_neuron(neighbor_states, own_state, external_input)

        # gMLP: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–∂–Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
        gmlp_output = self.gmlp_connections(own_state, neighbor_states, external_input)

        # –ü—Ä–æ–µ–∫—Ü–∏—è –∫ –µ–¥–∏–Ω–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
        nca_proj = self.nca_projection(nca_output)
        gmlp_proj = self.gmlp_projection(gmlp_output)

        # Learnable –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
        weights = torch.softmax(self.integration_weights, dim=0)
        integrated = weights[0] * nca_proj + weights[1] * gmlp_proj

        return integrated
```

#### 2.2 –°–æ–∑–¥–∞—Ç—å HybridLattice

```python
# new_rebuild/core/hybrid/hybrid_lattice.py
class HybridLattice3D:
    """3D —Ä–µ—à–µ—Ç–∫–∞ —Å Hybrid –∫–ª–µ—Ç–∫–∞–º–∏"""

    def __init__(self, config: ProjectConfig):
        self.config = config
        self.dimensions = config.lattice_dimensions
        self.total_cells = np.prod(self.dimensions)

        # –°–æ–∑–¥–∞–µ–º Hybrid –∫–ª–µ—Ç–∫–∏
        self.cells = nn.ModuleList([
            HybridCell(config) for _ in range(self.total_cells)
        ])

        # –ü—Ä–æ—Å—Ç–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è —Å–æ—Å–µ–¥—Å—Ç–≤–∞
        self.topology = self._build_topology()

    def forward(self, embeddings):
        """
        –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π forward pass —á–µ—Ä–µ–∑ –≤—Å–µ –∫–ª–µ—Ç–∫–∏
        """
        batch_size = embeddings.size(0)
        outputs = []

        for cell_idx in range(self.total_cells):
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ –∏ —Å–æ—Å–µ–¥–µ–π
            own_state = self.get_cell_state(cell_idx)
            neighbor_states = self.get_neighbor_states(cell_idx)
            external_input = self.get_external_input(cell_idx, embeddings)

            # Forward —á–µ—Ä–µ–∑ Hybrid –∫–ª–µ—Ç–∫—É
            cell_output = self.cells[cell_idx](own_state, neighbor_states, external_input)
            outputs.append(cell_output)

        return torch.stack(outputs, dim=1)
```

### **–≠–¢–ê–ü 3: –°–ò–°–¢–ï–ú–ê –û–ë–£–ß–ï–ù–ò–Ø** ‚è±Ô∏è 1-2 —á–∞—Å–∞

#### 3.1 –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π trainer

```python
# new_rebuild/training/trainer.py
class SimpleTrainer:
    """–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π trainer –±–µ–∑ CLI –∏ —Å–ª–æ–∂–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"""

    def __init__(self, config: ProjectConfig):
        self.config = config
        self.device = torch.device(config.device if config.device != "auto"
                                 else "cuda" if torch.cuda.is_available() else "cpu")

        # –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å
        self.model = HybridLattice3D(config).to(self.device)

        # –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä
        self.optimizer = torch.optim.AdamW(
            self.model.parameters(),
            lr=config.learning_rate
        )

        # Loss —Ñ—É–Ω–∫—Ü–∏—è
        self.criterion = nn.MSELoss()

    def train_step(self, input_embeddings, target_embeddings):
        """–û–¥–∏–Ω —à–∞–≥ –æ–±—É—á–µ–Ω–∏—è"""
        self.optimizer.zero_grad()

        # Forward pass
        outputs = self.model(input_embeddings)

        # Loss (reconstruction)
        loss = self.criterion(outputs, target_embeddings)

        # Backward pass
        loss.backward()
        self.optimizer.step()

        return loss.item()

    def train_epoch(self, dataloader):
        """–û–¥–∏–Ω epoch –æ–±—É—á–µ–Ω–∏—è"""
        total_loss = 0
        for batch_idx, (inputs, targets) in enumerate(dataloader):
            inputs = inputs.to(self.device)
            targets = targets.to(self.device)

            loss = self.train_step(inputs, targets)
            total_loss += loss

        return total_loss / len(dataloader)
```

### **–≠–¢–ê–ü 4: DATA PIPELINE** ‚è±Ô∏è 1 —á–∞—Å

#### 4.1 –†–∞–±–æ—Ç–∞ —Å embeddings

```python
# new_rebuild/data/embeddings.py (data\embedding_adapter\universal_adapter.py)
class EmbeddingProcessor:


    def __init__(self, config: ProjectConfig):
        self.config = config
        self.embedding_dim = config.embedding_dim

    def process_phrases(self, phrases: List[str], model_name="distilbert"):
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ü–µ–ª—ã–µ —Ñ—Ä–∞–∑—ã –≤ embeddings
        """
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è embeddings
        from transformers import AutoTokenizer, AutoModel

        tokenizer = AutoTokenizer.from_pretrained(model_name)
        model = AutoModel.from_pretrained(model_name)

        embeddings = []
        for phrase in phrases:
            tokens = tokenizer(phrase, return_tensors="pt", padding=True, truncation=True)
            with torch.no_grad():
                outputs = model(**tokens)
                # –ë–µ—Ä–µ–º [CLS] token –∏–ª–∏ mean pooling
                embedding = outputs.last_hidden_state.mean(dim=1)
                embeddings.append(embedding)

        return torch.stack(embeddings)

    def create_phrase_pairs(self, questions: List[str], answers: List[str]):
        """
        –°–æ–∑–¥–∞–µ—Ç –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
        """
        question_embeddings = self.process_phrases(questions)
        answer_embeddings = self.process_phrases(answers)

        return list(zip(question_embeddings, answer_embeddings))
```

### **–≠–¢–ê–ü 5: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –í–ê–õ–ò–î–ê–¶–ò–Ø** ‚è±Ô∏è 1-2 —á–∞—Å–∞

#### 5.1 –ü–æ—ç—Ç–∞–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã

```python
# new_rebuild/tests/test_step_by_step.py

def test_nca_cell():
    """–¢–µ—Å—Ç NCA –∫–ª–µ—Ç–∫–∏"""
    config = ProjectConfig()
    cell = NCACell(config)

    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    own_state = torch.randn(1, config.nca_state_size)
    neighbor_states = torch.randn(1, config.nca_neighbor_count, config.nca_state_size)

    output = cell(neighbor_states, own_state)

    assert output.shape == own_state.shape
    assert cell.count_parameters() <= config.nca_target_params * 1.1  # 10% tolerance
    print(f"‚úÖ NCA Cell: {cell.count_parameters()} params")

def test_gmlp_cell():
    """–¢–µ—Å—Ç gMLP –∫–ª–µ—Ç–∫–∏"""
    config = ProjectConfig()
    cell = GMLPCell(config)

    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    own_state = torch.randn(1, config.gmlp_state_size)
    neighbor_states = torch.randn(1, config.nca_neighbor_count, config.gmlp_state_size)

    output = cell(own_state, neighbor_states)

    assert output.shape == own_state.shape
    print(f"‚úÖ gMLP Cell: {cell.count_parameters()} params")

def test_hybrid_cell():
    """–¢–µ—Å—Ç Hybrid –∫–ª–µ—Ç–∫–∏"""
    config = ProjectConfig()
    cell = HybridCell(config)

    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    own_state = torch.randn(1, config.nca_state_size)
    neighbor_states = torch.randn(1, config.nca_neighbor_count, config.nca_state_size)

    output = cell(own_state, neighbor_states)

    total_params = cell.count_parameters()
    expected_params = config.nca_target_params + config.gmlp_target_params

    print(f"‚úÖ Hybrid Cell: {total_params} params (expected ~{expected_params})")

def test_lattice_3d():
    """–¢–µ—Å—Ç 3D —Ä–µ—à–µ—Ç–∫–∏"""
    config = ProjectConfig()
    lattice = HybridLattice3D(config)

    # –¢–µ—Å—Ç–æ–≤—ã–µ embeddings
    batch_size = 2
    embeddings = torch.randn(batch_size, config.embedding_dim)

    output = lattice(embeddings)

    expected_shape = (batch_size, lattice.total_cells, config.nca_state_size)
    assert output.shape == expected_shape

    print(f"‚úÖ Lattice 3D: {lattice.dimensions} = {lattice.total_cells} cells")

def test_full_pipeline():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ pipeline"""
    config = ProjectConfig()

    # –î–∞–Ω–Ω—ã–µ
    questions = ["What is AI?", "How does neural network work?"]
    answers = ["AI is artificial intelligence", "Neural networks learn patterns"]

    # –û–±—Ä–∞–±–æ—Ç–∫–∞
    processor = EmbeddingProcessor(config)
    pairs = processor.create_phrase_pairs(questions, answers)

    # –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
    trainer = SimpleTrainer(config)

    for i, (input_emb, target_emb) in enumerate(pairs):
        loss = trainer.train_step(input_emb.unsqueeze(0), target_emb.unsqueeze(0))
        print(f"‚úÖ Training step {i}: loss = {loss:.4f}")

if __name__ == "__main__":
    test_nca_cell()
    test_gmlp_cell()
    test_hybrid_cell()
    test_lattice_3d()
    test_full_pipeline()
    print("üéâ ALL TESTS PASSED!")
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### **PHASE 1: Foundation** ‚è±Ô∏è 1-2 —á–∞—Å–∞

- [ ] **1.1** –°–æ–∑–¥–∞—Ç—å `new_rebuild/config/project_config.py`
- [ ] **1.2** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `MinimalNCACell` ‚Üí `core/cells/nca_cell.py`
- [ ] **1.3** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `EmergentGMLPCell` ‚Üí `core/cells/gmlp_cell.py`
- [ ] **1.4** –°–æ–∑–¥–∞—Ç—å `BaseCell` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] **1.5** –°–æ–∑–¥–∞—Ç—å `SimpleLattice3D`
- [ ] **1.6** –¢–µ—Å—Ç: –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### **PHASE 2: Hybrid Architecture** ‚è±Ô∏è 2-3 —á–∞—Å–∞

- [ ] **2.1** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `HybridCell`
- [ ] **2.2** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `HybridLattice3D`
- [ ] **2.3** –¢–µ—Å—Ç: hybrid forward pass —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **2.4** –í–∞–ª–∏–¥–∞—Ü–∏—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ

### **PHASE 3: Training System** ‚è±Ô∏è 1-2 —á–∞—Å–∞

- [ ] **3.1** –°–æ–∑–¥–∞—Ç—å `SimpleTrainer`
- [ ] **3.2** –°–æ–∑–¥–∞—Ç—å `EmbeddingProcessor`
- [ ] **3.3** –¢–µ—Å—Ç: –æ–¥–∏–Ω epoch –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] **3.4** –í–∞–ª–∏–¥–∞—Ü–∏—è: loss —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è

### **PHASE 4: Integration & Testing** ‚è±Ô∏è 1-2 —á–∞—Å–∞

- [ ] **4.1** –ü–æ–ª–Ω—ã–µ end-to-end —Ç–µ—Å—Ç—ã
- [ ] **4.2** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è usage examples
- [ ] **4.3** Performance benchmarks
- [ ] **4.4** –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: 16¬≥ ‚Üí 32¬≥ ‚Üí 64¬≥

### **PHASE 5: Production Ready** ‚è±Ô∏è 1 —á–∞—Å

- [ ] **5.1** –°–æ–∑–¥–∞—Ç—å `main.py` entry point
- [ ] **5.2** –ü—Ä–æ—Å—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] **5.3** Save/load functionality
- [ ] **5.4** README —Å quick start

---

## üéØ EXPECTED RESULTS

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ü–µ–ª–∏:**

- ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: NCA ~69, gMLP ~23k, Hybrid ~23k
- ‚úÖ **–†–µ—à–µ—Ç–∫–∞**: –ù–∞—á–∞–ª–æ 16¬≥ (4k –∫–ª–µ—Ç–æ–∫) ‚Üí —Ü–µ–ª—å 666√ó666√ó333 (148M –∫–ª–µ—Ç–æ–∫)
- ‚úÖ **–≠–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞ —Å—á–µ—Ç biological –ø—Ä–∞–≤–∏–ª
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –û–¥–∏–Ω config —Ñ–∞–π–ª, Python API, –±–µ–∑ CLI

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- ‚úÖ **Memory**: Efficient –¥–ª—è 16¬≥ —Ä–µ—à–µ—Ç–∫–∏
- ‚úÖ **Speed**: Forward pass < 100ms –Ω–∞ GPU
- ‚úÖ **Scalability**: Linear scaling –¥–æ 64¬≥+

### **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**

- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
- ‚úÖ **Testability**: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ **Maintainability**: –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ magic

---

## üöÄ –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

**–°–µ–≥–æ–¥–Ω—è (2-3 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã):**

1. üìÅ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
2. ‚öôÔ∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ProjectConfig`
3. üß† –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `MinimalNCACell` –∏ `EmergentGMLPCell`
4. üîó –°–æ–∑–¥–∞—Ç—å `HybridCell`
5. ‚úÖ –ü–µ—Ä–≤—ã–µ —Ç–µ—Å—Ç—ã

**–ó–∞–≤—Ç—Ä–∞:**

1. üï∏Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `HybridLattice3D`
2. üéì –°–æ–∑–¥–∞—Ç—å `SimpleTrainer`
3. üìä –ü–æ–ª–Ω—ã–µ end-to-end —Ç–µ—Å—Ç—ã
4. üìà Benchmark –Ω–∞ –º–∞–ª–æ–π —Ä–µ—à–µ—Ç–∫–µ

**–≠—Ç–∞ –Ω–µ–¥–µ–ª—è:**

1. üéØ Production –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥
2. üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã
3. üîÑ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 64¬≥
4. üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –æ–±—É—á–µ–Ω–∏—é

---

**STATUS**: üéØ READY TO START  
**CONFIDENCE**: üî• HIGH (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã)  
**TIMELINE**: 2-3 –¥–Ω—è –¥–æ production ready system
