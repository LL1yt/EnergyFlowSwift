graph TB
    subgraph "Stage 1.3 DialogueDataset Architecture"
        subgraph "Input Data Sources"
            QA["Q&A Pairs<br/>dialogue_pairs"]
            CONV["Multi-turn Conversations<br/>conversations"]
            FILES["File Sources<br/>JSON/JSONL/CSV"]
        end

        subgraph "DialogueDataset Core"
            CONFIG["DialogueConfig<br/>teacher_model: distilbert<br/>embedding_dim: 768<br/>validation_split: 0.2"]
            
            subgraph "Data Processing Pipeline"
                FILTER["Quality Filter<br/>min/max length<br/>semantic validation"]
                EXTRACT["Q&A Extractor<br/>conversation → pairs<br/>multiturn support"]
                SPLIT["Train/Val Split<br/>configurable ratio"]
            end
            
            subgraph "Teacher LLM Integration"
                LOADER["EmbeddingLoader<br/>Teacher LLM Interface"]
                CACHE["Smart Cache<br/>8x+ speedup<br/>intelligent storage"]
                EMBED["Embedding Generation<br/>text → 768D vectors"]
            end
            
            DATASET["DialogueDataset<br/>PyTorch Dataset<br/>Q&A embeddings"]
        end

        subgraph "Teacher LLM Models"
            DISTIL["DistilBERT<br/>768D embeddings<br/>recommended"]
            LLAMA["LLaMA 2/3<br/>variable dimensions"]
            BERT["BERT variants<br/>768D compatible"]
            OTHER["8+ models<br/>automatic fallback"]
        end

        subgraph "3D Cubic Core Integration"
            CUBE["CubeTrainer<br/>dialogue mode<br/>[8,8,12] = 768D"]
            PROC["EmbeddingProcessor<br/>Q→A transformation<br/>3D CNN processing"]
            TRAIN["Training Loop<br/>question_emb → answer_emb"]
        end

        subgraph "Output & Validation"
            LOADER_OUT["DataLoader<br/>batch processing<br/>train/val modes"]
            STATS["Statistics<br/>quality metrics<br/>cache performance"]
            META["Metadata<br/>dialogue tracking<br/>sample analysis"]
        end
    end

    %% Data Flow
    QA --> FILTER
    CONV --> EXTRACT
    FILES --> FILTER
    
    EXTRACT --> FILTER
    FILTER --> SPLIT
    SPLIT --> CONFIG
    
    CONFIG --> LOADER
    LOADER --> DISTIL
    LOADER --> LLAMA  
    LOADER --> BERT
    LOADER --> OTHER
    
    DISTIL --> CACHE
    LLAMA --> CACHE
    BERT --> CACHE
    OTHER --> CACHE
    
    CACHE --> EMBED
    EMBED --> DATASET
    
    DATASET --> LOADER_OUT
    DATASET --> STATS
    DATASET --> META
    
    %% Integration Flow
    DATASET --> CUBE
    CUBE --> PROC
    PROC --> TRAIN
    
    %% Architecture Annotations
    classDef inputNode fill:#e1f5fe
    classDef processNode fill:#f3e5f5
    classDef coreNode fill:#e8f5e8
    classDef outputNode fill:#fff3e0
    classDef teacherNode fill:#ffebee
    classDef cubeNode fill:#e0f2f1
    
    class QA,CONV,FILES inputNode
    class FILTER,EXTRACT,SPLIT,LOADER,CACHE,EMBED processNode
    class CONFIG,DATASET coreNode
    class LOADER_OUT,STATS,META outputNode
    class DISTIL,LLAMA,BERT,OTHER teacherNode
    class CUBE,PROC,TRAIN cubeNode 