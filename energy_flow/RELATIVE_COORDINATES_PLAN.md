# –ü–ª–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

- –ü–æ—Ç–æ–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç –Ω–∞ –≤—Ö–æ–¥–Ω–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç–∏ Z=0
- –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –í—ã—Ö–æ–¥–Ω–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å –Ω–∞ Z=depth
- –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π: Z=58-60 –≤–º–µ—Å—Ç–æ Z=0
- –±–µ–∑ —Ñ–æ–ª–±—ç–∫–æ–≤, –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–π –ª–µ–≥–∞—Å–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É –∏–ª–∏ –æ—à–∏–±–∫–∞. —Å–º–µ–ª–æ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É.
- –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

- **–í—Ö–æ–¥–Ω–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å**: Z = depth/2 (—Ü–µ–Ω—Ç—Ä –∫—É–±–∞)
- **–í—ã—Ö–æ–¥–Ω—ã–µ –ø–ª–æ—Å–∫–æ—Å—Ç–∏**: Z = 0 –∏ Z = depth (–∫—Ä–∞—è –∫—É–±–∞)
- **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ**: –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è (Œîx, Œîy, Œîz)
- **Spawn**: –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–ª–∏–Ω—ã –≤–µ–∫—Ç–æ—Ä–∞ —Å–º–µ—â–µ–Ω–∏—è
- **–û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü**: –¥–ª—è X/Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)

**–§–∞–π–ª**: `energy_flow/config/energy_config.py`

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:

```python
# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
relative_coordinates: bool = False
center_start_enabled: bool = False
dual_output_planes: bool = False

# –°–∏—Å—Ç–µ–º–∞ spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è
spawn_movement_threshold_ratio: float = 0.1  # depth/10
movement_based_spawn: bool = False

# –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
boundary_reflection_enabled: bool = False

# –°–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏
proximity_weight: float = 0.7
path_length_weight: float = 0.3
safe_distance_minimum: float = 0.5
```

**‚è≥ –¢–†–ï–ë–£–ï–¢–°–Ø**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π debug/experiment/optimized —Å –Ω–æ–≤—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏

### 2. –°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)

**–§–∞–π–ª**: `energy_flow/utils/normalization.py`

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ LEGACY –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–±–µ–∑ fallback)
- ‚úÖ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–º–µ—â–µ–Ω–∏–π:

  ```python
  def normalize_displacement(self, displacement: torch.Tensor) -> torch.Tensor:
      # [-depth/2, depth/2] ‚Üí [-1, 1]

  def denormalize_displacement(self, normalized: torch.Tensor) -> torch.Tensor:
      # [-1, 1] ‚Üí [-depth/2, depth/2]
  ```

- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Z-–¥–∏–∞–ø–∞–∑–æ–Ω–∞: `[0, depth]` –≤–º–µ—Å—Ç–æ `[0, depth*2-1]`
- ‚úÖ –§–∞–±—Ä–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `create_normalization_manager()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### 3. EnergyCarrier (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)

**–§–∞–π–ª**: `energy_flow/core/energy_carrier.py`

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

1. ‚úÖ **–ù–æ–≤—ã–π –≤—ã—Ö–æ–¥ –º–æ–¥–µ–ª–∏**: `displacement_projection` –≤–º–µ—Å—Ç–æ `position_projection`
2. ‚úÖ **–£–¥–∞–ª–µ–Ω curriculum learning**: smart initialization, forward bias
3. ‚úÖ **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è**:
   ```python
   def forward(self, ...):
       # –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏—è –≤ [-1,1]
       displacement_raw = self.displacement_projection(gru_output)
       displacement_normalized = self.displacement_activation(displacement_raw)  # Tanh

       # –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è
       displacement_real = self.config.normalization_manager.denormalize_displacement(
           displacement_normalized
       )

       # –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
       next_position = current_position + displacement_real
   ```
4. ‚úÖ **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥**: `_compute_next_position_relative()` –¥–ª—è —Ç—Ä–µ—Ö–ø–ª–æ—Å–∫–æ—Å—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 4. EnergyLattice (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)

**–§–∞–π–ª**: `energy_flow/core/energy_lattice.py`

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

1. ‚úÖ **–°—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ**:

   ```python
   def place_initial_energy(self, embeddings, mapper):
       # –†–∞–∑–º–µ—â–∞–µ–º –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –Ω–∞ Z = depth/2
       start_z = self.depth // 2
       for (x, y), energy, batch_idx in cell_energies:
           position = torch.tensor([x, y, start_z], device=self.device)
           flow_id = self._create_flow(position, energy, batch_idx)
   ```

2. ‚úÖ **–î–≤–æ–π–Ω–æ–π –≤—ã—Ö–æ–¥–Ω–æ–π –±—É—Ñ–µ—Ä**:

   ```python
   self.output_buffer_z0: Dict[Tuple[int, int], List[EnergyFlow]] = {}  # Z=0
   self.output_buffer_zdepth: Dict[Tuple[int, int], List[EnergyFlow]] = {} # Z=depth

   def _buffer_flow_to_z0_plane(self, flow_id: int): # Z=0 –ø–ª–æ—Å–∫–æ—Å—Ç—å
   def _buffer_flow_to_zdepth_plane(self, flow_id: int): # Z=depth –ø–ª–æ—Å–∫–æ—Å—Ç—å
   ```

3. ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏ —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–µ–ª–µ–Ω–∏–µ–º**:

   ```python
   def calculate_flow_importance(self, flow: EnergyFlow) -> float:
       z = flow.position[2].item()
       distance_to_z0 = abs(z - 0)
       distance_to_zdepth = abs(z - self.depth)
       min_distance = min(distance_to_z0, distance_to_zdepth)

       # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ
       safe_distance = max(min_distance, self.config.safe_distance_minimum)
       proximity = 1.0 / safe_distance

       path_importance = flow.age * self.config.path_length_weight
       return self.config.proximity_weight * proximity + path_importance
   ```

4. ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: `reset()`, `clear_output_buffer()`, `get_buffered_flows_count()`, `get_all_buffered_flows()`

### 5. FlowProcessor (‚è≥ –í –ü–†–û–¶–ï–°–°–ï)

**–§–∞–π–ª**: `energy_flow/core/flow_processor.py`

**‚è≥ –¢–†–ï–ë–£–ï–ú–´–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

1. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π**:

   ```python
   def apply_displacement(self, current_pos: torch.Tensor, displacement: torch.Tensor) -> torch.Tensor:
       new_position = current_pos + displacement

       if self.config.boundary_reflection_enabled:
           new_position = self.reflect_boundaries(new_position)

       return new_position
   ```

2. **–û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü**:

   ```python
   def reflect_boundaries(self, position: torch.Tensor) -> torch.Tensor:
       x, y, z = position[:, 0], position[:, 1], position[:, 2]

       # –û—Ç—Ä–∞–∂–µ–Ω–∏–µ X
       x = torch.where(x < 0, -x, x)
       x = torch.where(x >= self.config.lattice_width,
                      2*(self.config.lattice_width-1) - x, x)

       # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è Y
       # Z –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

       return torch.stack([x, y, z], dim=1)
   ```

3. **Spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–ª–∏–Ω—ã —Å–º–µ—â–µ–Ω–∏—è**:
   ```python
   def check_movement_spawn(self, displacement: torch.Tensor, flow_ids: torch.Tensor) -> List[SpawnInfo]:
       displacement_lengths = torch.norm(displacement, dim=1)  # [batch]
       threshold = self.config.lattice_depth * self.config.spawn_movement_threshold_ratio

       spawn_mask = displacement_lengths > threshold
       spawn_info = []

       for i, should_spawn in enumerate(spawn_mask):
           if should_spawn:
               delta_length = displacement_lengths[i].item()
               direction = displacement[i] / delta_length  # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
               num_spawns = int((delta_length - threshold) // threshold)

               # –°–æ–∑–¥–∞–µ–º spawn info
               energies = [self.get_flow_energy(flow_ids[i])] * num_spawns
               spawn_info.append(SpawnInfo(energies=energies, parent_batch_idx=i))

       return spawn_info
   ```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –û–±–Ω–æ–≤–∏—Ç—å `_process_results_vectorized()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ `termination_reasons` –æ—Ç EnergyCarrier

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª**: `energy_flow/utils/logging.py`

**–ù–æ–≤—ã–µ debug —É—Ä–æ–≤–Ω–∏**:

```python
DEBUG_RELATIVE = 21      # –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —Å–º–µ—â–µ–Ω–∏—è
DEBUG_SPAWN_MOVEMENT = 22 # Spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è
DEBUG_REFLECTION = 23     # –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
DEBUG_IMPORTANCE = 24     # –°–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø–æ—Ç–æ–∫–æ–≤
```

### 7. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

#### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (‚úÖ –ó–ê–í–ï–†–®–ï–ù)

- [x] ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [x] ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–º–µ—â–µ–Ω–∏–π
- [ ] ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ debug —É—Ä–æ–≤–Ω–∏

#### –≠—Ç–∞–ø 2: –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ (‚úÖ –ó–ê–í–ï–†–®–ï–ù)

- [x] ‚úÖ –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å EnergyCarrier –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å–º–µ—â–µ–Ω–∏–π
- [x] ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å EnergyLattice –¥–ª—è —Ç—Ä–µ—Ö–ø–ª–æ—Å–∫–æ—Å—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [ ] ‚è≥ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å FlowProcessor –¥–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è (**–¢–ï–ö–£–©–ò–ô**)

#### –≠—Ç–∞–ø 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (‚è≥ –°–õ–ï–î–£–Æ–©–ò–ô)

- [ ] ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–ª–∏–Ω—ã —Å–º–µ—â–µ–Ω–∏—è
- [ ] ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–ª—è X/Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- [x] ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≤–∞–∂–Ω–æ—Å—Ç–∏ —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–µ–ª–µ–Ω–∏–µ–º

#### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (‚è≥ –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø)

- [ ] ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å trainer'–æ–º

#### –≠—Ç–∞–ø 5: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ (‚è≥ –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø)

- [ ] ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å debug/experiment –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìç –°–¢–ê–¢–£–° –ù–ê –¢–ï–ö–£–©–ò–ô –ú–û–ú–ï–ù–¢

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **EnergyConfig** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
2. **–°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–º–µ—â–µ–Ω–∏–π, —É–¥–∞–ª–µ–Ω legacy –∫–æ–¥
3. **EnergyCarrier** - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π, —É–¥–∞–ª–µ–Ω curriculum learning
4. **EnergyLattice** - —Ç—Ä–µ—Ö–ø–ª–æ—Å–∫–æ—Å—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –¥–≤–æ–π–Ω–æ–π –±—É—Ñ–µ—Ä, —Å–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏

### ‚è≥ –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞:

- **FlowProcessor** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–º–µ—â–µ–Ω–∏—è–º–∏

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:

1. **–ü–†–ò–û–†–ò–¢–ï–¢ 1**: –ó–∞–≤–µ—Ä—à–∏—Ç—å FlowProcessor - –æ–±–Ω–æ–≤–∏—Ç—å `_process_results_vectorized()` –¥–ª—è –Ω–æ–≤—ã—Ö `termination_reasons`
2. **–ü–†–ò–û–†–ò–¢–ï–¢ 2**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∏ spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è
3. **–ü–†–ò–û–†–ò–¢–ï–¢ 3**: –û–±–Ω–æ–≤–∏—Ç—å debug –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:

- EnergyCarrier —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–∏–ø—ã `termination_reasons`: `"reached_z0_plane"`, `"reached_zdepth_plane"`, `"xy_reflection_needed"`
- FlowProcessor –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–ª—è `"xy_reflection_needed"`
- –°–∏—Å—Ç–µ–º–∞ spawn —Ç–µ–ø–µ—Ä—å –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –¥–ª–∏–Ω–µ —Å–º–µ—â–µ–Ω–∏—è, –∞ –Ω–µ –Ω–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞—Ö

### 8. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ñ–ª–∞–≥–∞–º–∏, —Å—Ç–∞—Ä–∞—è –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π
2. **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Å–≤—è–∑–∏**: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è GPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. **–û—Ç–ª–∞–¥–∫–∞**: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 9. –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è**: —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
2. **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ**: –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –¥–≤–∏–∂–µ–Ω–∏—é –±–µ–∑ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏—è
3. **–ì–∏–±–∫–æ—Å—Ç—å**: –ø–æ—Ç–æ–∫–∏ –º–æ–≥—É—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
4. **–õ—É—á—à–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –æ–±—ä–µ–º–∞ –∫—É–±–∞
5. **–ë–æ–ª–µ–µ –±–æ–≥–∞—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã**: spawn –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è

### 10. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- **–£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤**: % –ø–æ—Ç–æ–∫–æ–≤ –¥–æ—Å—Ç–∏–≥–∞—é—â–∏—Ö –≤—ã—Ö–æ–¥–∞ (—Ü–µ–ª—å: >90%)
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–ª–æ—Å–∫–æ—Å—Ç—è–º**: —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–µ–∏—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–ª–æ—Å–∫–æ—Å—Ç–µ–π
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ loss
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ RTX 5090
