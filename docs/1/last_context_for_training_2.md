# üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ EmbeddingTrainer –¥–ª—è 3D Cellular Neural Network

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ü–µ–ª—å
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è 3D –∫—É–±–∞ –∫–ª–µ—Ç–æ—á–Ω—ã—Ö –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –Ω–∞ —ç–º–±–µ–¥–∏–Ω–≥–∞—Ö –æ—Ç LLM –º–æ–¥–µ–ª–µ–π (DistilBERT 768D) —Å teacher-student –ø–æ–¥—Ö–æ–¥–æ–º.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π EmbeddingTrainer
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –≤ `new_rebuild/core/training/embedding_trainer.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è —Å loss —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ checkpoint'–æ–≤, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ—Ä–æ–≥–æ–≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ LatticeSettings:
  - max_radius = max_dimension √ó adaptive_radius_ratio (0.2)
  - local_distance_threshold = max_radius √ó local_distance_ratio (0.1)
  - functional_distance_threshold = max_radius √ó functional_distance_ratio (0.65)
  - distant_distance_threshold = max_radius √ó distant_distance_ratio (1.0)
- ‚úÖ –£–±—Ä–∞–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –∏–∑ NeighborSettings
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ get_distance_thresholds() –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞ Embedding ‚Üí Lattice Mapping:**
- ‚úÖ –°–æ–∑–¥–∞–Ω EmbeddingToLatticeMapper - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ 3D –∫—É–±–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω LatticeToEmbeddingExtractor - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ —Å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω VolumeStateInitializer - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫

### 3. üõ†Ô∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: `logger.info()` –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö
- **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã**: `setup_logging()` –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –≤ `SimpleProjectConfig.__post_init__()`
- **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–º —á–µ—Ä–µ–∑ `config.logging.level`

### 4. üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
```python
# –í config_components.py
class TrainingEmbeddingSettings:
    max_total_samples: Optional[int] = None  # –û–±—â–∏–π –ª–∏–º–∏—Ç —Å—ç–º–ø–ª–æ–≤
    gpu_memory_reserve_gb: float = 20.0     # –†–µ–∑–µ—Ä–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

class LoggingSettings:
    level: str = "INFO"                     # –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å
    debug_mode: bool = False                # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É level
```

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### `new_rebuild/core/training/utils/unified_dataset_loader.py`
- Early stopping –≤ `_load_*()` –º–µ—Ç–æ–¥–∞—Ö
- GPU-only –≤–∞–ª–∏–¥–∞—Ü–∏—è `_gpu_filter_and_validate()`
- –£–º–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ `GPUMemoryEstimator`
- RTX 5090 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ DataLoader

### `new_rebuild/config/simple_config.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `setup_logging()` –≤ `__post_init__()`
- –ü–µ—Ä–µ–¥–∞—á–∞ `level` –∏ `log_file` –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### `new_rebuild/utils/logging.py` 
- –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `level` –≤ `setup_logging()`
- –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: `debug_mode > level > INFO`

### `new_rebuild/config/config_components.py`
- `max_total_samples` –∏ `gpu_memory_reserve_gb`
- `debug_mode = False` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
- üêå –ó–∞–≥—Ä—É–∑–∫–∞ 1M+ —Å—ç–º–ø–ª–æ–≤ –¥–∞–∂–µ –¥–ª—è –ª–∏–º–∏—Ç–∞ 10
- üîÑ CPU fallback'–∏ –∑–∞–º–µ–¥–ª—è–ª–∏ GPU –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ùå Pin memory –æ—à–∏–±–∫–∏

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
- ‚ö° Early stopping: –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- üöÄ –°—Ç—Ä–æ–≥–∏–π GPU-only: –Ω–µ—Ç CPU –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π
- üíæ –£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ª–∏–º–∏—Ç–æ–≤
- üìù –†–∞–±–æ—Ç–∞—é—â–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –°—Ç–∞—Ç—É—Å

‚úÖ **GPU Dataset**: –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ª–∏–º–∏—Ç–∞–º–∏
‚úÖ **GPU-only —Ä–µ–∂–∏–º**: –ë–µ–∑ fallback'–æ–≤ –Ω–∞ CPU  
‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–º**: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
üîß **Minor**: Unicode fix –¥–ª—è Windows (—ç–º–æ–¥–∂–∏ ‚Üí ASCII)

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ RTX 5090:
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å early stopping
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU –ø–∞–º—è—Ç–∏
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ì–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é