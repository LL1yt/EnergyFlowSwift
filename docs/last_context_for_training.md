# üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ EmbeddingTrainer –¥–ª—è 3D Cellular Neural Network

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ü–µ–ª—å
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è 3D –∫—É–±–∞ –∫–ª–µ—Ç–æ—á–Ω—ã—Ö –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –Ω–∞ —ç–º–±–µ–¥–∏–Ω–≥–∞—Ö –æ—Ç LLM –º–æ–¥–µ–ª–µ–π (DistilBERT 768D) —Å teacher-student –ø–æ–¥—Ö–æ–¥–æ–º.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π EmbeddingTrainer
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –≤ `new_rebuild/core/training/embedding_trainer.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è —Å loss —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ checkpoint'–æ–≤, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ—Ä–æ–≥–æ–≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ LatticeSettings:
  - max_radius = max_dimension √ó adaptive_radius_ratio (0.2)
  - local_distance_threshold = max_radius √ó local_distance_ratio (0.1)
  - functional_distance_threshold = max_radius √ó functional_distance_ratio (0.65)
  - distant_distance_threshold = max_radius √ó distant_distance_ratio (1.0)
- ‚úÖ –£–±—Ä–∞–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –∏–∑ NeighborSettings
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ get_distance_thresholds() –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞ Embedding ‚Üí Lattice Mapping:**
- ‚úÖ –°–æ–∑–¥–∞–Ω EmbeddingToLatticeMapper - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ 3D –∫—É–±–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω LatticeToEmbeddingExtractor - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ —Å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω VolumeStateInitializer - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ù–æ–≤—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
Teacher Embeddings (768D) ‚Üí
Surface Embeddings (8√ó8=64D) ‚Üí
3D Lattice States ‚Üí
Emergent Dynamics (5 —à–∞–≥–æ–≤ MoE) ‚Üí
Surface Extraction ‚Üí
Teacher Embeddings (768D)
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
- EmbeddingTransformer - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ teacher ‚Üî surface —ç–º–±–µ–¥–∏–Ω–≥–æ–≤
- EmbeddingToLatticeMapper - surface ‚Üí 3D lattice —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Lattice3D - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è 3D —Ä–µ—à–µ—Ç–∫–∞ —Å MoE —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏
- LatticeToEmbeddingExtractor - 3D lattice ‚Üí surface —ç–º–±–µ–¥–∏–Ω–≥–∏
- TextDecoder - –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç

### 4. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ loss —Ñ—É–Ω–∫—Ü–∏–∏
- Reconstruction Loss - MSE –º–µ–∂–¥—É –≤—ã—Ö–æ–¥–æ–º –∏ —Ü–µ–ª–µ–≤—ã–º–∏ —ç–º–±–µ–¥–∏–Ω–≥–∞–º–∏
- Similarity Loss - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cosine similarity
- Diversity Loss - –ø–æ–æ—â—Ä–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –≤—ã—Ö–æ–¥–æ–≤
- Emergence Loss - –ø–æ–æ—â—Ä–µ–Ω–∏–µ —ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- Lattice Dynamics Loss - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ—à–µ—Ç–∫–µ
- Spatial Consistency Loss - —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫

### 5. –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç-—Å–∫—Ä–∏–ø—Ç
- `test_embedding_trainer.py` - –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ forward pass, –æ–±—É—á–µ–Ω–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, checkpoint'–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ RTX 5090

---

## üõ†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–∏–π —á–∞—Ç)

### –ü—Ä–æ–±–ª–µ–º–∞: AttributeError —Å SimpleProjectConfig
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **Lattice3DSettings ‚Üí LatticeSettings**: 
   - –£–±—Ä–∞–ª–∏ enable_moe (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω)
   - –î–æ–±–∞–≤–∏–ª–∏ enable_morton_encoding, target_performance_ms

2. **AdaptiveChunkerSettings**: 
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –¥–ª—è GPU chunking
   - max_history, optimal_batch_size, preferred_device –∏ –¥—Ä.

3. **InitSettings**: 
   - seed, reproducible, init_method, gain

4. **UnifiedOptimizerSettings**: 
   - neighbors_found_factor, chunks_processed_div
   - performance_monitoring_enabled, cache_statistics

### –ü—Ä–∏–Ω—Ü–∏–ø: –ù–ï–¢ FALLBACK'–∞–º!
- –£–±—Ä–∞–Ω—ã –≤—Å–µ fallback –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ MemoryPoolManager
- –°–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫
- –î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤–∞–∂–Ω–æ —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ª–∏—á–Ω–æ, –∞ –Ω–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –∏—Ö

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π —Ç–µ–Ω–∑–æ—Ä–æ–≤
1. **EmbeddingTransformer vs LatticeMapper**:
   - EmbeddingTransformer: [batch, 8, 8] (3D surface)
   - LatticeMapper: [batch, 64] (flat)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

2. **Lattice forward pass**:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π —á–µ—Ä–µ–∑ `lattice.states`
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Ä–µ—à–µ—Ç–∫–∏

3. **MemoryPoolManager**:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ return_tensor –≤–º–µ—Å—Ç–æ release_tensor
   - –£–±—Ä–∞–Ω—ã –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤–º–µ—Å—Ç–æ —Å–ª–æ–≤–∞—Ä–µ–π

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

### –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω–æ—Å—Ç—å
- –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–µ –≤—Ö–æ–¥—ã ‚Üí –æ–±—ä–µ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–µ –≤—ã—Ö–æ–¥—ã
- –ê–Ω–∞–ª–æ–≥–∏—è —Å –∫–æ—Ä–æ–π –º–æ–∑–≥–∞: –≤—Ö–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–±—ä–µ–º–µ

### –ù–∞—Å—Ç–æ—è—â–∞—è —ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –ù–µ wrapper –º–µ—Ç–æ–¥, –∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤ 3D
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–∏–Ω–∞–º–∏–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö MoE —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —Å–≤—è–∑–µ–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –õ–µ–≥–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç 8√ó8√ó8 –∫ 37√ó37√ó37 –∫—É–±–∞–º
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ GPU-—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä–æ–≥–æ–≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑ fallback'–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ß–µ—Ç–∫–∏–µ –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

---

## üöÄ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: 
–ë–∞–∑–æ–≤—ã–π —Ç—Ä–µ–Ω–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. **–ì–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∑–∞–ø—É—Å–∫—É –æ–±—É—á–µ–Ω–∏—è.**
