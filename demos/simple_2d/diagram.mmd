graph TD
    %% === –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï –ò –ü–ê–¢–¢–ï–†–ù–´ ===
    subgraph INPUT["üéØ –í—Ö–æ–¥–Ω—ã–µ –ü–∞—Ç—Ç–µ—Ä–Ω—ã"]
        PG["PatternGenerator"]
        PS["point_source()"]
        WS["wave_source()"] 
        PP["pulse_pattern()"]
        
        PG --> PS
        PG --> WS
        PG --> PP
    end
    
    %% === –û–°–ù–û–í–ù–ê–Ø –†–ï–®–ï–¢–ö–ê ===
    subgraph LATTICE["üß¨ 2D –†–µ—à–µ—Ç–∫–∞"]
        L2D["Simple2DLattice"]
        CELL["CellPrototype<br/>(–∏–∑ core)"]
        STATES["Cell States<br/>[height, width, state_size]"]
        HISTORY["History Buffer<br/>–¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏"]
        
        L2D --> CELL
        L2D --> STATES
        L2D --> HISTORY
    end
    
    %% === –ê–õ–ì–û–†–ò–¢–ú –û–ë–ù–û–í–õ–ï–ù–ò–Ø ===
    subgraph UPDATE["‚ö° –ê–ª–≥–æ—Ä–∏—Ç–º –û–±–Ω–æ–≤–ª–µ–Ω–∏—è"]
        NEIGHBORS["get_neighbors()<br/>4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"]
        SYNC["–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ<br/>–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"]
        BOUNDARY["–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è<br/>(–∑–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ)"]
        
        NEIGHBORS --> SYNC
        BOUNDARY --> SYNC
    end
    
    %% === –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø ===
    subgraph VIZ["üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è"]
        DV["Demo2DVisualizer"]
        STATIC["plot_current_state()"]
        ANIM["create_animation()"]
        CMAP["–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞<br/>neural colormap"]
        
        DV --> STATIC
        DV --> ANIM
        DV --> CMAP
    end
    
    %% === –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò ===
    subgraph DEMOS["üìä –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏"]
        D1["run_wave_demo()<br/>–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ–ª–Ω—ã"]
        D2["run_pulse_demo()<br/>–†–∞–¥–∏–∞–ª—å–Ω—ã–π –∏–º–ø—É–ª—å—Å"]
        D3["run_interference_demo()<br/>–ò–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü–∏—è –≤–æ–ª–Ω"]
        
        D1 -.->|"20 —à–∞–≥–æ–≤"| D1
        D2 -.->|"15 —à–∞–≥–æ–≤"| D2  
        D3 -.->|"25 —à–∞–≥–æ–≤"| D3
    end
    
    %% === –í–´–•–û–î–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ ===
    subgraph OUTPUT["üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã"]
        IMGS["–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è<br/>.png"]
        GIFS["–ê–Ω–∏–º–∞—Ü–∏–∏<br/>.gif"] 
        DATA["–î–∞–Ω–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏<br/>–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –º–µ—Ç—Ä–∏–∫–∏"]
        
        IMGS --> SAVE["visualizations/"]
        GIFS --> SAVE
        DATA --> SAVE
    end
    
    %% === –ì–õ–ê–í–ù–´–ï –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–• ===
    INPUT -->|"external_input"| LATTICE
    LATTICE -->|"step()"| UPDATE
    UPDATE -->|"new_states"| LATTICE
    LATTICE -->|"history"| VIZ
    VIZ --> OUTPUT
    
    %% === –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–û–ù–ù–´–ï –ü–û–¢–û–ö–ò ===
    DEMOS -->|"–∏—Å–ø–æ–ª—å–∑—É–µ—Ç"| INPUT
    DEMOS -->|"—É–ø—Ä–∞–≤–ª—è–µ—Ç"| LATTICE
    DEMOS -->|"–≤—ã–∑—ã–≤–∞–µ—Ç"| VIZ
    
    %% === –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ü–†–û–ï–ö–¢–û–ú ===
    subgraph CORE["üîß Core –ú–æ–¥—É–ª–∏"]
        CP["core.cell_prototype"]
        CONFIG["create_cell_from_config()"]
        
        CP --> CONFIG
    end
    
    CORE -->|"–∏–º–ø–æ—Ä—Ç"| LATTICE
    
    %% === –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–° ===
    subgraph UI["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å"]
        MAIN["main()"]
        PAUSE["–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—É–∑—ã"]
        PROGRESS["–°–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ"]
        
        MAIN --> PAUSE
        MAIN --> PROGRESS
    end
    
    UI -->|"–∑–∞–ø—É—Å–∫–∞–µ—Ç"| DEMOS
    
    %% === –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–£–¢–ò ===
    INPUT -.->|"CRITICAL"| LATTICE
    LATTICE -.->|"CRITICAL"| UPDATE
    UPDATE -.->|"CRITICAL"| LATTICE
    
    %% === –°–¢–ò–õ–ò ===
    classDef inputStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef coreStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef processStyle fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef outputStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef criticalStyle fill:#ffebee,stroke:#c62828,stroke-width:3px
    
    class INPUT,PG,PS,WS,PP inputStyle
    class CORE,CP,CONFIG coreStyle
    class LATTICE,UPDATE,VIZ processStyle
    class OUTPUT,IMGS,GIFS,DATA outputStyle
    class L2D,CELL,SYNC criticalStyle 